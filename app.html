<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/style.css" rel="stylesheet" type="text/css" /> 
<link href="css/jquery.css" rel="stylesheet" type="text/css" /> 
<link href='http://fonts.googleapis.com/css?family=Nunito:400,700' rel='stylesheet' type='text/css'>
  <script src="js/jquerymin.js"></script>
  <script src="js/stats.js"></script>
  <script src="js/jquery-uimin.js"></script>
  <script src="js/foursquare-js-api-0.1.5.js"></script>
  <script src="js/api.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<title>One more Check-in</title>

<script>

function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}

var code  = gup('code');
alert("loading ...");
Services.authenticate(code, function () {
  alert("authentifié");
  
  Infos.grab();
}, function () {
  document.location = "/";
});
function initialiser_map() {

				var latlng = new google.maps.LatLng(-33.890542, 151.274856);
				//objet contenant des propriétés avec des identificateurs prédéfinis dans Google Maps permettant
				//de définir des options d'affichage de notre carte
				var options = {
					center: latlng,
					zoom: 19,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					streetViewControl: false
				};
				//constructeur de la carte qui prend en paramêtre le conteneur HTML
				//dans lequel la carte doit s'afficher et les options
				var carte = new google.maps.Map(document.getElementById("carte"), options);
				setMarkers(carte, checkins, "img/example_cat.png");
}
				
				
				
var checkins = [
				  ['Bondi Beach', -33.890542, 151.274856, 4,"VOILA"],
				  ['Coogee Beach', -33.923036, 151.259052, 5,"VOILI"],
				  ['Cronulla Beach', -34.028249, 151.157507, 3,"voilou"],
				  ['Manly Beach', -33.80010128657071, 151.28747820854187, 2,"ahaha"],
				  ['Maroubra Beach', -33.950198, 151.259302, 1,"voilouqdqsdsqqsd"]
				];

function setMarkers(map, locations, urlcat) {
  // Add markers to the map
  // Marker sizes are expressed as a Size of X,Y
  // where the origin of the image (0,0) is located
  // in the top left of the image.
  // Origins, anchor positions and coordinates of the marker
  // increase in the X direction to the right and in
  // the Y direction down.
  	  var cat = new google.maps.MarkerImage(urlcat,
      // This marker is 20 pixels wide by 32 pixels tall.
      new google.maps.Size(32, 32),
      // The origin for this image is 0,0.
      new google.maps.Point(0,0),
      // The anchor for this image is the base of the flagpole at 0,32.
      new google.maps.Point(0, 32));
  	  var fond = new google.maps.MarkerImage("img/check_map.png",
      // The shadow image is larger in the horizontal dimension
      // while the position and offset are the same as for the main image.
      new google.maps.Size(69, 80),
      new google.maps.Point(0,0),
      new google.maps.Point(18, 50));
      // Shapes define the clickable region of the icon.
      // The type defines an HTML <area> element 'poly' which
      // traces out a polygon as a series of X,Y points. The final
      // coordinate closes the poly by connecting to the first
      // coordinate.
	  var shape = {
		  coord: [1, 1, 1, 60, 40, 30, 40 , 1],
		  type: 'poly'
	  };
  
	  var listmarker = Array();
	  for (var i = 0; i < locations.length; i++) {
			var checkin = locations[i];
			var myLatLng = new google.maps.LatLng(checkin[1], checkin[2]);
			var marker = new google.maps.Marker({
				markercount:i,
				position: myLatLng,
				map: map,
				shadow: fond,
				icon: cat,
				shape: shape,
				title: checkin[0],
				zIndex: checkin[3],
				description:checkin[4]
		});
	
		var contentString = '<div id="content">'+
        '<div id="siteNotice">'+
        '</div>'+
        '<h1 id="firstHeading" class="firstHeading">'+marker.title+'</h1>'+
        '<div id="bodyContent">'+
        '<p><b>'+marker.description+'</b>' +
        '</div>'+
        '</div>';
        
		var infowindow = new google.maps.InfoWindow({
			content: contentString
		});
	
		listmarker[i]={id:i,markertag:marker};
		google.maps.event.addListener(listmarker[i]["markertag"], 'click', function() {
		alert("Ouais j'ai cliqué sur le marqueur !."+listmarker[1]["markertag"].position);//message d'alerte
		
		
		var size = (listmarker.length < 10) ? listmarker.length : 10;
 	    for(var y=0; y < size; y++) {
			infowindow.open(map,listmarker[y]["markertag"]);
		}

	    });
	   
  }
							
}



</script>


</head>






<body onload="initialiser_map()">

<div align="center">
    <div id="graybox">   
    </div>
    
    <div id="global">
    
    	<!--  DEBUT DU HEADER   --> 
    	<div id="header">
       		<div id="logo">
            </div>
            
            <div id="h_sentence"><h1>What you will get with one more check-in ?</h1></div>
        	<div class="clear"></div>
            <div id="login">
        	<p>Welcome <span id="prenom_nom"></span> <a href="/">Disconnect</a></p>
    		</div>
        </div>
        <!--  FIN DU HEADER   --> 
        
        
        <!--  DEBUT CONTENT --> 
        <div id="content">
        
            <h2>Discover the next badges you can unlock !</h2>
            
            <div style="float:left">
            <p style="float:left; margin:6px 6px 0 0;"><b>Display :</b></p>
            <a href="#" id="btn_easy" class="btn active"></a>
            <a href="#" id="btn_near" class="btn"></a>
            </div>
            
            <div style="float:right; margin:15px 0 0 0;">
            <p>Your last check-in : <b><span id="last_check"></span></b></p>
            </div>
        	
        	<div class="clear"></div>
        	<div id="list_checkins" style="float:left">
                <ul id="list_badges">
                	<li class="box_badge" id="id_box_badge01">
                    	<div class="img_badge"><img src="img/example_badge.png" /></div>
                        <div class="infos_badges">
                            <p class="titre_badge"><a href="#">Unlock Adventurer</a></p>
                            <div class="cat_badge"><img src="img/example_cat.png"/></div>
                            <p class="description_badge">Do 1 check-in in a bar venue with 3 others (opposite sex) </p>
                            <p class="findit_badge"><a href="">Find it now!</a> <span class="txt_hurry">Hurry up! 2 hours left.</span></p>
                        </div>
                        
                        <div class="pourcent_badge">
                                    <script>$(document).ready(function() {$("#progressbar01").progressbar({ value: 80 });});</script>
                                    <div class="pastille"><p class="txt_pastille" style="">90%</p></div>
                                    <div id="progressbar01"></div>    
                        </div>
                     </li>
                     
                     <li class="box_badge" id="id_box_badge01">
                    	<div class="img_badge"><img src="img/example_badge.png" /></div>
                        <div class="infos_badges">
                            <p class="titre_badge"><a href="#">Unlock Adventurer</a></p>
                            <div class="cat_badge"><img src="img/example_cat.png"/></div>
                            <p class="description_badge">Do 1 check-in in a bar venue with 3 others (opposite sex) </p>
                            <p class="findit_badge"><a href="" onclick="javascript:infowindow.open(map,marker);">Find it now!</a></p>
                        </div>
                        
                        <div class="pourcent_badge">
                                    <script>$(document).ready(function() {$("#progressbar02").progressbar({ value: 30 });});</script>
                                    <div class="pastille"><p class="txt_pastille" style="">30%</p></div>
                                    <div id="progressbar02"></div>    
                        </div>
                     </li>
                     
                     <li class="box_badge" id="id_box_badge01">
                    	<div class="img_badge"><img src="img/example_badge.png" /></div>
                        <div class="infos_badges">
                            <p class="titre_badge"><a href="#">Unlock Adventurer</a></p>
                            <div class="cat_badge"><img src="img/example_cat.png"/></div>
                            <p class="description_badge">Do 1 check-in in a bar venue with 3 others (opposite sex) </p>
                            <p class="findit_badge"><a href="">Find it now!</a></p>
                        </div>
                        
                        <div class="pourcent_badge">
                                    <script>$(document).ready(function() {$("#progressbar03").progressbar({ value: 70 });});</script>
                                    <div class="pastille"><p class="txt_pastille" style="">70%</p></div>
                                    <div id="progressbar03"></div>    
                        </div>
                     </li>
                     
                     <li class="box_badge" id="id_box_badge01">
                    	<div class="img_badge"><img src="img/example_badge.png" /></div>
                        <div class="infos_badges">
                            <p class="titre_badge"><a href="#">Unlock Adventurer</a></p>
                            <div class="cat_badge"><img src="img/example_cat.png"/></div>
                            <p class="description_badge">Do 1 check-in in a bar venue with 3 others (opposite sex) </p>
                            <p class="findit_badge"><a href="">Find it now!</a></p>
                        </div>
                        
                        <div class="pourcent_badge">
                                    <script>$(document).ready(function() {$("#progressbar04").progressbar({ value: 10 });});</script>
                                    <div class="pastille"><p class="txt_pastille" style="">10%</p></div>
                                    <div id="progressbar04"></div>    
                        </div>
                     </li>
                </ul>
            
            	<div id="pagination">
                	<div id="previous" style="float:left; font-weight:bold">Previous</div>
                    <div id="next" style="float:right; font-weight:bold">Next</div>
                
                </div>
            </div>
            <div id="ggmap">
            	<div id="carte" style="width:100%; height:100%"></div>
            </div>
        
            <div class="clear"></div>
            <br/>
            <h2>Your stats</h2>
        	
            <div id="box_stats">
            	<div>
                	<div style="float:left; margin-right:50px;">
                        <h3>Main stats</h3>
                        <ul class="ulstats">
                        
                      
                            <li id="icocheck" ><span id="count_check" style="vertical-align:top; font-weight:bold; color:#555555"></span><span style="vertical-align:top"> check-ins</span></li>
                            <li id="icostar" ><span id="countbadges_check" style="vertical-align:top; font-weight:bold;color:#555555"></span> <span style="vertical-align:top"> badges unlocked</span></li>
                            <li id="icocouronne" ><span id="mayor_check" style="vertical-align:top; font-weight:bold;color:#555555"></span> <span style="vertical-align:top"> mayorships</span></li>
                        </ul>
                    </div>
                    
                    <div style="margin-right:50px;">
                        <h3>Last badges unlocked</h3>
                        <ul class="ulstats" id="ulstatsdyn">
                         
                        </ul>
                    </div>
                    
                    <!--
                    <div style="margin-left:40px;">
                        <h3>Ranking</h3>
                        <ul class="ulstats">
                            <li><span style="vertical-align:top; font-weight:bold; color:#555555">#299</span><span style="vertical-align:top"> on OneMoreCheckin</span></li>
                            <li><span style="vertical-align:top; font-weight:bold; color:#555555">#299</span><span style="vertical-align:top"> on OneMoreCheckin</span></li>
                            <li><span style="vertical-align:top; font-weight:bold; color:#555555">#299</span><span style="vertical-align:top"> on OneMoreCheckin</span></li>
                        </ul>
                    </div>
                    -->
                    
                    <div id="imgcheckbig"></div>
                    
                </div>
                
                
            </div>
        	
        </div>
        <!--  FIN CONTENT --> 
        
        
    </div>
    
    <div id="bluebox">
    </div>   

    <div id="footer">
        <div style="float:left">
        <a href="http://www.spoke.fr" target="_blank"><img src="img/logo_spoke.png" /></a><br/>
        <p style="margin:5px 0 0 0;">OneMoreCheckin.com is a service provided by SPOKE, a <a href="http://www.spoke.fr" class="lienblanc" target="_blank">Social Media agency</a> based in Paris.</p>
        <p>Our team developed this version during the Foursquare Global Hackathon 2011.</p>
        </div>
        <div style="float:right; margin:25px 0 0 0;">
         <a href="http://www.spoke.fr" id="btn_discover" target="_blank"></a>
         <a href="http://www.spoke.fr/contact" id="btn_contact" target="_blank"></a>
        </div>
    
    </div>

</div>

<div></div>
</body>
</html>
